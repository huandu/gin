<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Mouse Tracer - gin samples</title>
<style type="text/css">
html {
 height: 100%;
}

body {
 overflow: hidden;
 margin: 0;
 height: 100%;
 background-color: #000000;
}
</style>
</head>
<body id="device">
<script type="text/javascript" src="../../gin.js"></script>
<script type="text/javascript">
function Bubbles() {}
Bubbles.prototype = {
	bubbles: [],
	render: function(ctx) {
		for (var i in this.bubbles) {
			var bubble = this.bubbles[i];
			
			ctx.beginPath();
			ctx.strokeStyle = 'rgba(' + bubble.r + ',' + bubble.g + ',' + bubble.b + ','
				+ Math.min(.4, bubble.life * 0.01) + ')';
			ctx.lineWidth = bubble.w;
			ctx.arc(bubble.x, bubble.y, (bubble.radius += bubble.step), 0, Math.PI * 2, true);
			ctx.stroke();
			
			bubble.life--;
			
			if (!bubble.life) {
				delete this.bubbles[i];
			}
		}
	},
	create: function(x, y) {
		this.bubbles.push(this._random(
			x + 7 - Math.floor(Math.random() * 14),
			y + 7 - Math.floor(Math.random() * 14)));
		return this;
	},
	_random: function(x, y) {
		return {
			radius: Math.floor(Math.random() * 20) + 10,
			x: x,
			y: y,
			r: Math.floor(Math.random() * 255),
			g: Math.floor(Math.random() * 255),
			b: Math.floor(Math.random() * 255),
			w: Math.floor(Math.random() * 4) + 1,
			step: Math.floor(Math.random() * 10) + 2,
			life: Math.floor(Math.random() * 25) + 20
		};
	}
};

function Dots() {}
Dots.prototype = {
	dots: [],
	create: function(x, y) {
		this.dots.push({
			radius: Math.floor(Math.random() * 4) + 2,
			x: x,
			y: y,
			r: Math.floor(Math.random() * 255),
			g: Math.floor(Math.random() * 255),
			b: Math.floor(Math.random() * 255),
			life: Math.floor(Math.random() * 25) + 20
		});
	},
	render: function(ctx) {
		for (var i in this.dots) {
			var dot = this.dots[i];
			
			ctx.beginPath();
			ctx.fillStyle = 'rgba(' + dot.r + ',' + dot.g + ',' + dot.b + ','
				+ Math.min(1, dot.life * 0.04) + ')';
			ctx.arc(dot.x, dot.y, dot.radius, 0, Math.PI * 2, true);
			ctx.fill();
			
			dot.life--;
			
			if (!dot.life) {
				delete this.dots[i];
			}
		}
	}
};

const MOUSE_LBUTTON = 0;

var gin = $G('device', {
	fps: 30,
	autoResize: true,
}, {
	start: function(){
		var bubbles = new Bubbles();
		var dots = new Dots();
		this.data('bubbles', bubbles);
		this.data('dots', dots);
	},
	render: function(e) {
		var bubbles = this.data('bubbles');
		var dots = this.data('dots');
		
		if (e.mouseover && e.hasFocus) {
			e.traverseHistory(function(history) {
				bubbles.create(history.clientX, history.clientY);
				
				if (e.buttonStates[MOUSE_LBUTTON]) {
					dots.create(history.clientX, history.clientY);
				}
			});
		} else {
			e.clearHistory();
		}
		
		var ctx = e.context;
		ctx.clearRect(0, 0, this.width(), this.height());
		bubbles.render(e.context);
		dots.render(e.context);
	},
});
</script>
</body>
</html>