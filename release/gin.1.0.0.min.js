/*
 * gin JavaScript Library v1.0.0
 * https://github.com/huandu/gin/
 *
 * Copyright 2011, Huan Du
 * Licensed under the MIT license
 * https://github.com/huandu/gin/blob/master/LICENSE
 */
(function(O,j){const l=30;const a=1;const y=100;const G=1;const H=2;const g=3;const v=4;const s=1;const m=2;const q=3;const L=5;const T=100;const t=/^[a-zA-Z_\-][a-zA-Z_0-9\-]*$/;const k=/\s+/;const J=/^-?\d+(\.\d*)?$/;const e=300;const P=function(){};const r=16;const V=17;const Q=18;const B=10000;const n=B+1;var c=O.document,o=(function(){var W=function(aa,Z,Y){return new W.prototype.init(aa,Z,Y)};W.prototype={init:function(Z,ab,af){if(!Z){A("id cannot be empty");return}var ag=ab||{},ad=af||{},aa=Date.now(),ac,ae,Y;if(Z.nodeType){ac=Z}else{if(typeof Z==="string"){ac=c.getElementById(Z);if(!ac){A("cannot find element by id. [id: "+Z+"]");return}}else{A("invalid id. [id: "+Z.toString()+"]");return}}this._={element:ac,state:G,framePrepared:false,frameRenderedPerSecond:0,frameRenderingTimeInSecond:0,frameCountInSecond:0,lastResize:aa,e:{keyStates:[],buttonStates:[],startTime:aa,lastTime:aa,stats:{frameCount:0,mousemoveCount:0,fps:0,mps:0},clientX:0,clientY:0,mouseover:false,hasFocus:true},mousemoveHistory:{current:0,last:0,traverseLast:0,length:0},fps:b(ag.fps,l,J,function(ah){if(ah<a||ah>y){A("fps setting must in range of ["+a+", "+y+"]. [fps: "+ah+"]");return}return ah}),width:b(ag.width,ac.clientWidth,J,function(ah){if(ah<=0){return}ac.style.width=ah+"px";ac.width=ah;return ah}),height:b(ag.height,ac.clientHeight,J,function(ah){if(ah<=0){return}ac.style.height=ah+"px";ac.height=ah;return ah}),autoPause:b(ag.autoPause,false,function(ah){return ah===true?ah:j}),listeners:{start:d(ad,"start"),pause:d(ad,"pause"),stop:d(ad,"stop"),restart:d(ad,"restart"),blur:d(ad,"blur"),focus:d(ad,"focus")}};this._.interval=1000/this._.fps;ae=X.prototype.create({width:this._.width,height:this._.height,left:0,top:0,core:this,name:"root",parent:null,parentElement:ac},{beforerender:d(ad,"beforerender"),render:d(ad,"render"),size:d(ad,"size"),destroy:function(){this.core().stop()}});if(!ae){A("cannot create default layer instance");return}f(this.resize,ae.width);f(this.resize,ae.height);this._.layer=ae;Y=c.createElement("div");this._.receiver=Y;Y._={core:this};Y.style.position="absolute";Y.style.left=0;Y.style.top=0;Y.style.width=this._.width+"px";Y.style.height=this._.height+"px";Y.style.zIndex=B;Y.style.outline=0;Y.tabIndex=1;ac.appendChild(Y);Y.focus();Y.addEventListener("blur",I,false);Y.addEventListener("focus",U,false);Y.addEventListener("keydown",z,false);Y.addEventListener("keyup",z,false);Y.addEventListener("mouseover",D,false);Y.addEventListener("mouseout",D,false);Y.addEventListener("mousedown",p,false);Y.addEventListener("mouseup",p,false);Y.addEventListener("contextmenu",M,false);Y.addEventListener("mousemove",h,false);if(b(ag.autoStart,true,function(ah){return ah===false?ah:j})){this.start()}return this},layer:function(){return this._.layer},start:function(Z){if(Z instanceof Function){this._.listeners.start=Z;return this}if(this._.state==H){return this}if(this._.state!=G&&this._.state!=v&&this._.state!=g){A("only GIN_STATE_INIT, GIN_STATE_STOPPED and GIN_STATE_PAUSED can be started. [state: "+this._.state+"]");return this}this._.listeners.start.call(this.layer());this._.frameRenderingTimeInSecond=Date.now()%1000;var Y=this;this._.timer=O.setInterval(function(){var aa=Date.now(),af=Y._.fps,ae=Y._.e,ac=Y._.e.stats,ab=Y.layer(),ad=Y._.mousemoveHistory;F.call(Y._,ae,aa);if(Y._.frameCountInSecond>=af&&Y._.framePrepared){return}ae.timeStamp=aa;if(!Y._.framePrepared){ad.traverseLast=ad.last;ab.beforerender();Y._.framePrepared=true}aa=Date.now();F.call(Y._,ae,aa);if(!Y._.frameCountInSecond||(aa%1000)-Y._.frameCountInSecond*Y._.interval+L>=0){ae.timeStamp=aa;ad.traverseLast=ad.last;ab.render();if(aa-Y._.lastResize>T){Y.resize();Y._.lastResize=aa}ab.updateStyle();ac.frameCount++;Y._.frameCountInSecond++;ae.lastTime=aa;Y._.framePrepared=false}},1);this._.state=H;x("gin is started");return this},pause:function(Y){if(Y instanceof Function){this._.listeners.pause=Y;return this}if(this._.state==g){return this}if(this._.state!=H){A("only GIN_STATE_STARTED can be started. [state: "+this._.state+"]");return this}if(this._.timer){O.clearInterval(this._.timer);this._.timer=0}this._.listeners.pause.call(this.layer());this._.state=g;x("gin is paused");return this},stop:function(Y){if(Y instanceof Function){this._.listeners.stop=Y;return this}if(this._.state==v){return this}if(this._.state!=H&&this._.state!=g){A("only GIN_STATE_STARTED and GIN_STATE_PAUSED can be stopped. [state: "+this._.state+"]");return this}if(this._.timer){O.clearInterval(this._.timer);this._.timer=0}this._.listeners.stop.call(this.layer());this._.state=v;x("gin is stopped");return this},restart:function(Y){if(Y instanceof Function){this._.listeners.restart=Y;return this}if(this._.state!=H&&this._.state!=g){A("only GIN_STATE_STARTED and GIN_STATE_PAUSED can be restarted. [state: "+this._.state+"]");return this}this._.listeners.restart.call(this.layer());this.stop();this.start();return this},blur:function(Y){if(Y instanceof Function){this._.listeners.blur=Y;return this}if(this._.e.hasFocus){this._.e.hasFocus=false;this._.e.keyStats=[];if(this._.autoPause){this.pause()}}},focus:function(Y){if(Y instanceof Function){this._.listeners.focus=Y;return this}if(!this._.e.hasFocus){this._.e.hasFocus=true;if(this._.autoPause){this.start()}}},resize:function(ae,Y){var Z=ae||this._.element.clientWidth,ad=Y||this._.element.clientHeight,ac=this._.element,af=this._.receiver,ab=this.layer(),aa=false;if(isNaN(Z)||Z<0||isNaN(ad)||ad<0){A("invalid width or height");return this}if(Z!=this._.width){aa=true;this._.width=Z;af.style.width=Z+"px";ab.width(Z);if(Z!=this._.element.clientWidth){ac.style.width=Z+"px";ac.width=Z}}if(ad!=this._.height){aa=true;this._.height=ad;af.style.height=ad+"px";ab.height(ad);if(ad!=this._.element.clientHeight){ac.style.height=ad+"px";ac.height=ad}}if(aa){ab.size()}},width:function(){return this._.width},height:function(){return this._.height},cloneEvent:function(){var Y=u(this._.e);Y.mousemoveHistory=this._.mousemoveHistory;Y.traverseHistory=S;Y.clearHistory=w;Y.offsetX=Y.offsetY=0;return Y}};function X(){}X.prototype={create:function(ae,ad){var aa=new X(),ac=ae||{},ab=ad||{},Z,Y;if(ac.parent!==null&&!(ac.parent instanceof X)){A("parent must be GinLayer instance or null");return}if(!ac.core){A("core must be set");return}if(!ac.name){A("layer must have a string name");return}if(!ac.parentElement){A("parent element must be set when parent is null");return}Z=c.createElement("div");Z.style.position="absolute";Z.style.display="block";aa._={name:ac.name,parent:ac.parent,core:ac.core,element:Z,parentElement:ac.parentElement,layers:{},newStyle:{},data:b(ac.data,{}),dataHooks:{},offsetX:0,offsetY:0,detached:ac.parent?false:true,dialogMode:false,attachment:b(ac.attachment,null,function(af){if(!af||!af.nodeType){A("attachment must be a DOM element");return}return af}),style:{width:b(ac.width,0,J,function(af){if(af<=0){return}Z.style.width=af+"px";return af}),height:b(ac.height,0,J,function(af){if(af<=0){return}Z.style.height=af+"px";return af}),left:b(ac.left,0,J,function(af){Z.style.left=af+"px";return af}),top:b(ac.top,0,J,function(af){Z.style.top=af+"px";return af})},listeners:{beforerender:d(ab,"beforerender"),render:d(ab,"render"),destroy:d(ab,"destroy"),size:d(ab,"size"),play:d(ab,"play"),stop:d(ab,"stop")}};if(ac.parent){aa._.offsetX=ac.parent.offsetX+ac.parent.left;aa._.offsetY=ac.parent.offsetY+ac.parent.top}Y=c.createElement("canvas");Y.style.position="absolute";Y.style.left=0;Y.style.top=0;Y.style.width=aa._.style.width+"px";Y.style.height=aa._.style.height+"px";Y.width=aa._.style.width;Y.height=aa._.style.height;Z.appendChild(Y);aa._.canvas=Y;aa._.parentElement.appendChild(Z);if(aa._.attachment){Z.appendChild(aa._.attachment)}if(b(ac.hidden,false,function(af){return af===true?af:j})){aa.hide()}if(b(ac.autoPlay,true,function(af){return af===false?af:j})){aa.play()}if(b(ac.dialogMode,false,function(af){return af===true?af:j})){aa.dialog(true)}return aa},layers:function(Y,ad,ac){var ab=ad||{},ae=Y,aa,Z;if(ad===j){if(typeof Y!=="string"&&!(Y instanceof Array)){A("name must be string or array");return}if(this._.layers[Y]){return this._.layers[Y]}if(typeof Y==="string"){ae=Y.split(k)}if(!ae.shift){A("names must be array or string");return}aa=ae.shift();if(!this._.layers[aa]){A("layer does not exist. [name: "+aa+"]");return}if(ae.length){return this._.layers[aa].layers(ae)}else{return this._.layers[aa]}}if(this._.layers[Y]){x("layer already exists. [name: "+Y+"]");return this}if(!t.test(Y)){A("invalid layer name. [name: "+Y+"]");return}ab.parent=this;ab.parentElement=this._.element;ab.core=this.core();ab.name=Y;Z=this.create(ab,ac);if(!Z){A("cannot create new layer");return}this._.layers[Y]=Z;return this},name:function(){return this._.name},parent:function(){return this._.parent},core:function(){return this._.core},element:function(){return this._.element},style:function(aa,Z){var Y=this._.newStyle;switch(aa){case"width":case"height":case"top":case"left":if(this._.style[aa]!=Z){Y[aa]=Z+"px"}}return this},left:function(Y){if(Y===j){return this._.style.left}if(J.test(Y)){this.style("left",Y)}return this},top:function(Y){if(Y===j){return this._.style.top}if(J.test(Y)){this.style("top",Y)}return this},width:function(Y){if(Y===j){return this._.style.width}if(!this._.parent&&!K(arguments)){A("unauthorized call to this function");return this}if(J.test(Y)&&Y>=0){this.style("width",Y)}return this},height:function(Y){if(Y===j){return this._.style.height}if(!this._.parent&&!K(arguments)){A("unauthorized call to this function");return this}if(J.test(Y)&&Y>=0){this.style("height",Y)}return this},draw:function(Z){if(!(Z instanceof Function)){A("callback must be a function");return this}var Y=R.call(this);Y.context=this._.canvas.getContext("2d");Y.context.save();Z.call(this,Y);Y.context.restore();C.call(this);return this},remove:function(Y){if(!this._.layers[Y]){A("layer does not exist. [name: "+Y+"]");return this}var Z=this._.layers[Y];delete this._.layers[Y];this._.element.removeChild(Z._.element);return this},detach:function(){if(this._.parent){this._.parent.remove(this._.name)}this._.detached=true;this._.parent=null;return this},attach:function(Y){if(!(Y instanceof X)){A("only GinLayer instance can be attached");return this}if(!Y._.detached){A("layer is not detached");return this}if(this._.layers[Y._.name]){A("layer name conflicts. [name: "+Y._.name+"]");return this}this._.layers[Y._.name]=Y;Y._.parent=this;Y._.detached=false;return this},attachTo:function(Y){},updateStyle:function(){var ab=this._.newStyle,aa=this._.element,Y=this._.canvas,Z;for(Z in this._.layers){this._.layers[Z].updateStyle()}if(i(ab)){return this}for(Z in ab){aa.style[Z]=ab[Z];this._.style[Z]=Math.round(parseFloat(ab[Z]))}for(Z in ab){switch(Z){case"width":case"height":Y.style[Z]=ab[Z];Y[Z]=Math.round(parseFloat(ab[Z]));break}}this._.newStyle={};return this},data:function(Y,aa,Z){if(Y===j){A("data key cannot be undefined");return}if(aa===j){return this._.data[Y]}if(Z instanceof Function){this._.dataHooks[Y]=Z}if(this._.dataHooks[Y]){this._.dataHooks[Y].call(this,aa,this._.data[Y])}this._.data[Y]=aa;return this},beforerender:function(Y){return N.call(this,"beforerender",Y,this._.playing,this._.playing,function(){return R.call(this)})},render:function(Y){return N.call(this,"render",Y,false,this._.playing,function(){this.draw(this._.listeners.render)})},destroy:function(Y){return N.call(this,"destroy",Y,true,true,function(){var Z=this._.parent;if(Z){Z.remove(this.name())}})},play:function(Y){return N.call(this,"play",Y,!this._.playing,false,function(){this._.playing=true})},stop:function(Y){return N.call(this,"stop",Y,this._.playing,false,function(){this._.playing=false})},size:function(Y){return N.call(this,"size",Y,true,true,function(){return{width:this.core().width(),height:this.core().height()}})},show:function(){this._.element.style.display="block";return this},hide:function(){this._.element.style.display="none";return this},dialog:function(Y){if(Y&&!this._.dialogMode){this._.dialogMode=true;this._.element.style.zIndex=n}else{if(!Y&&this._.dialogMode){this._.dialogMode=false;this._.element.style.zIndex=""}}return this}};W.prototype.init.prototype=W.prototype;return W})(),R=function(){var W=this.core().cloneEvent();W.layerName=this._.name;if(this._.parent){this._.offsetX=this._.parent._.offsetX+this._.parent.left();this._.offsetY=this._.parent._.offsetY+this._.parent.top()}W.offsetX=this._.offsetX+this.left();W.offsetY=this._.offsetY+this.top();W.clientX-=W.offsetX;W.clientY-=W.offsetY;W.layer=this;return W},C=function(){var W=this.element(),Y=W.style.left||0,X=W.style.top||0;if(this.left()!=Math.round(parseFloat(Y,10))){this.left(Y)}if(this.top()!=Math.round(parseFloat(X,10))){this.top(X)}},N=function(Y,ab,X,W,aa){if(ab instanceof Function){this._.listeners[Y]=ab;return this}var ac=j,Z;if((W||X)&&aa){ac=aa.call(this)}if(W){for(Z in this._.layers){this._.layers[Z][Y].call(this._.layers[Z],ac)}}if(X&&this._.listeners[Y]!=P){this._.listeners[Y].call(this,ac)}return this},u=function(Y){var X=new Y.constructor(),W;X.__proto__=Y;for(W in X){if(typeof X[W]==="object"){X[W]=u(X[W])}}return X},x=function(){try{console.debug.apply(console,arguments)}catch(W){}},A=function(){try{console.error.apply(console,arguments)}catch(W){}},F=function(Z,X){var Y=Z.stats,W=Math.floor(X/1000),aa=Math.floor(Z.lastTime/1000);if(W!=aa&&this.frameCountInSecond){Y.fps=this.frameCountInSecond;Y.mps=Y.mousemoveCount;this.frameCountInSecond=0;Y.mousemoveCount=0}},b=function(ab,aa,Z,Y){var X=Z instanceof RegExp?Z:null,W=Y instanceof Function?Y:Z instanceof Function?Z:function(ad){return ad},ac=j;if(ab!==j&&(!X||X.test(ab))){ac=W(ab)}return ac===j?aa:ac},d=function(W,X){if(W[X] instanceof Function){return W[X]}return P},z=function(Y){if(!this._||!this._.core){A("cannot find GinCore information");return}var X=this._.core._.e,W=Y.type==="keydown"?true:false;Y.stopPropagation();Y.preventDefault();if(!E[Y.keyCode]){X.keyStates[Y.keyCode]=W}X.shiftKey=Y.shiftKey;X.altKey=Y.altKey;X.ctrlKey=Y.ctrlKey;X.metaKey=Y.metaKey},h=function(Z){if(!this._||!this._.core){A("cannot find GinCore information");return}var W=this._.core._.e,Y=this._.core._.mousemoveHistory,X=Y[Y.last],aa=Z.mouseState||s;if(!X||X.clientX!=Z.clientX||X.clientY!=Z.clientY||aa!=X.mouseState||Y.last==Y.current){W.clientX=Z.clientX;W.clientY=Z.clientY;W.mouseover=true;W.stats.mousemoveCount++;Y.current=(Y.current+1)%e;Y.length=Y.length<e?Y.length+1:e;if(Y.current==Y.last){Y.last++}Y[Y.current]={clientX:Z.clientX,clientY:Z.clientY,mouseState:Z.mouseState,button:Z.button,timeStamp:Date.now()}}},p=function(Y){if(!this._||!this._.core){A("cannot find GinCore information");return}var X=this._.core._.e,W=Y.type==="mousedown"?true:false;X.buttonStates[Y.button]=W;Y.preventDefault();Y.mouseState=W?m:q;h.call(this,Y);if(W&&!this._.core._.e.hasFocus){this.focus()}},D=function(X){if(!this._||!this._.core){A("cannot find GinCore information");return}var W=this._.core._.e;W.mouseover=W.type=="mouseover"?true:false;if(!W.mouseover){W.buttonStates=[]}},M=function(W){W.preventDefault()},I=function(W){if(!this._||!this._.core){A("cannot find GinCore information");return}this._.core.blur()},U=function(W){if(!this._||!this._.core){A("cannot find GinCore information");return}this._.core.focus()},S=function(ad){if(!(ad instanceof Function)){return this}var ab=this.mousemoveHistory,aa=ab.current,Z=ab.traverseLast,X=Z,ac=null,Y=ab[X],W;if(aa==Z){return this}do{X=(X+1)%e;ac={clientX:ab[X].clientX-this.offsetX,clientY:ab[X].clientY-this.offsetY,mouseState:ab[X].mouseState,button:ab[X].button,timeStamp:ab[X].timeStamp};W=ad.call(this.layer,ac,Y);Y=ac}while(X!=aa&&W!==false);return this},w=function(){if(!this.mousemoveHistory){return this}var W=this.mousemoveHistory;W.last=W.current;return this},f=function(W,X){W._friends=W._friends||[];W._friends.push(X.toString());return W},K=function(Y){try{var ab=Y.callee,X=ab.caller,W=ab.toString(),aa=X._friends,Z;if(!X||!X._friends){return false}for(Z in aa){if(aa[Z]===W){return true}}return false}catch(ac){return false}},i=function(X){for(var W in X){return false}return true},E=[];E[r]=true;E[V]=true;E[Q]=true;O.$G=O.Gin=o})(window);